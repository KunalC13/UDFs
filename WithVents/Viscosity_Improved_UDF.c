
#include "udf.h"

DEFINE_PROPERTY(cell_viscosity, cell, thread)
{
    double temperature; /* Temperature in Kelvin */
    double viscosity;
    temperature = C_T(cell, thread); /* Assume Fluent provides temperature in Kelvin */

    /* Data points with X-axis converted to Kelvin for viscosity */
    double data[][2] = {
        {274.15, 1.000000},
        {273.15, 0.000000},
        {727.6709, 2.682492},
        {737.9009, 2.704399},
        {748.1407999999999, 2.720530},
        {758.3807999999999, 2.731198},
        {768.6047, 2.735075},
        {774.9408, 2.686508},
        {785.1809, 2.528033},
        {794.7708, 2.383039},
        {800.2809, 2.308537},
        {809.8808, 2.187502},
        {816.9209, 2.100325},
        {821.4009, 2.045572},
        {825.2409, 1.999135},
        {827.8009, 1.968456},
        {830.3509, 1.938138},
        {831.7309, 1.921621},
        {833.0108, 1.906352},
        {834.2909, 1.891135},
        {835.5606, 1.876095},
        {836.0309, 1.870525},
        {839.0108, 1.844208},
        {844.1308, 1.803886},
        {849.2508, 1.764719},
        {853.0909, 1.736075},
        {856.9309, 1.708038},
        {858.9009, 1.694049},
        {869.0609, 1.648970},
        {879.3009, 1.605934},
        {889.5409, 1.565168},
        {899.7809, 1.526549},
        {910.0208, 1.489959},
        {918.1209, 1.462190},
        {928.3609, 1.428355},
        {938.6009, 1.396330},
        {948.8409, 1.366014},
        {959.0640999999999, 1.337367},
        {966.9209, 1.314509},
        {977.1609, 1.285834},
        {987.4009, 1.258356},
        {997.6408, 1.232010},
        {1007.8809, 1.206736},
        {1018.1209, 1.182478},
        {1028.3609000000001, 1.159183},
        {1038.6009, 1.136803},
        {1048.8409000000001, 1.115292},
        {1059.0809, 1.094609},
        {1069.3209, 1.074716},
        {1079.5609, 1.055575},
        {1089.8009, 1.037154},
        {1100.0409, 1.019422},
        {1107.8109, 1.006407},
        {1118.0509, 0.989808},
        {1128.2909, 0.973821},
        {1138.5309, 0.958422},
        {1148.7608, 0.943603},

    };
    int num_points = sizeof(data) / sizeof(data[0]);

    /* Simple linear interpolation logic */
    if (temperature < data[0][0]) {
        return data[0][1]; /* Return the first value if below the data range */
    }
    int i;
    for (i = 0; i < num_points - 1; ++i) {
        if (temperature >= data[i][0] && temperature <= data[i+1][0]) {
            viscosity = data[i][1] + (data[i+1][1] - data[i][1]) * (temperature - data[i][0]) / (data[i+1][0] - data[i][0]);
            return viscosity;
        }
    }
    return data[num_points - 1][1]; /* Return the last value if above the data range */
}
