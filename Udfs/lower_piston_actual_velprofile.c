#include "udf.h"
static real time_array[] = {0.00100, 0.00200, 0.00300, 0.00400, 0.00500, 0.00600, 0.00700, 0.00800, 0.00900, 0.01000, 0.01100, 0.01200, 0.01300, 0.01400, 0.01500, 0.01600, 0.01700, 0.01800, 0.01900, 0.02000, 0.02100, 0.02200, 0.02300, 0.02400, 0.02500, 0.02600, 0.02700, 0.02800, 0.02900, 0.03000, 0.03100, 0.03200, 0.03300, 0.03400, 0.03500, 0.03600, 0.03700, 0.03800, 0.03900, 0.04000, 0.04100, 0.04200, 0.04300, 0.04400, 0.04500, 0.04600, 0.04700, 0.04800, 0.04900, 0.05000, 0.05100, 0.05200, 0.05300, 0.05400, 0.05500, 0.05600, 0.05700, 0.05800, 0.05900, 0.06000, 0.06100, 0.06200, 0.06300, 0.06400, 0.06500, 0.06600, 0.06700, 0.06800, 0.06900, 0.07000, 0.07100, 0.07200, 0.07300, 0.07400, 0.07500, 0.07600, 0.07700, 0.07800, 0.07900, 0.08000, 0.08100, 0.08200, 0.08300, 0.08400, 0.08500, 0.08600, 0.08700, 0.08800, 0.08900, 0.09000, 0.09100, 0.09200, 0.09300, 0.09400, 0.09500, 0.09600, 0.09700, 0.09800, 0.09900, 0.10000, 0.10100, 0.10200, 0.10300, 0.10400, 0.10500, 0.10600, 0.10700, 0.10800, 0.10900, 0.11000, 0.11100, 0.11200, 0.11300, 0.11400, 0.11500, 0.11600, 0.11700, 0.11800, 0.11900, 0.12000, 0.12100, 0.12200, 0.12300, 0.12400, 0.12500, 0.12600, 0.12700, 0.12800, 0.12900, 0.13000, 0.13100, 0.13200, 0.13300, 0.13400, 0.13500, 0.13600, 0.13700, 0.13800, 0.13900, 0.14000, 0.14100, 0.14200, 0.14300, 0.14400, 0.14500, 0.14600, 0.14700, 0.14800, 0.14900, 0.15000, 0.15100, 0.15200, 0.15300, 0.15400, 0.15500, 0.15600, 0.15700, 0.15800, 0.15900, 0.16000, 0.16100, 0.16200, 0.16300, 0.16400, 0.16500, 0.16600, 0.16700, 0.16800, 0.16900, 0.17000, 0.17100, 0.17200, 0.17300, 0.17400, 0.17500, 0.17600, 0.17700, 0.17800, 0.17900, 0.18000, 0.18100, 0.18200, 0.18300, 0.18400, 0.18500, 0.18600, 0.18700, 0.18800, 0.18900, 0.19000, 0.19100, 0.19200, 0.19300, 0.19400, 0.19500, 0.19600, 0.19700, 0.19800, 0.19900, 0.20000, 0.20100, 0.20200, 0.20300, 0.20400, 0.20500, 0.20600, 0.20700, 0.20800, 0.20900, 0.21000, 0.21100, 0.21200, 0.21300, 0.21400, 0.21500, 0.21600, 0.21700, 0.21800, 0.21900, 0.22000, 0.22100, 0.22200, 0.22300, 0.22400, 0.22500, 0.22600, 0.22700, 0.22800, 0.22900, 0.23000, 0.23100, 0.23200, 0.23300, 0.23400, 0.23500, 0.23600, 0.23700, 0.23800, 0.23900, 0.24000, 0.24100, 0.24200, 0.24300, 0.24400, 0.24500, 0.24600, 0.24700, 0.24800, 0.24900, 0.25000, 0.25100, 0.25200, 0.25300, 0.25400, 0.25500, 0.25600, 0.25700, 0.25800, 0.25900, 0.26000, 0.26100, 0.26200, 0.26300, 0.26400, 0.26500, 0.26600, 0.26700, 0.26800, 0.26900, 0.27000, 0.27100, 0.27200, 0.27300, 0.27400, 0.27500, 0.27600, 0.27700, 0.27800, 0.27900, 0.28000, 0.28100, 0.28200, 0.28300, 0.28400, 0.28500, 0.28600, 0.28700, 0.28800, 0.28900, 0.29000, 0.29100, 0.29200, 0.29300, 0.29400, 0.29500, 0.29600, 0.29700, 0.29800, 0.29900, 0.30000, 0.30100, 0.30200, 0.30300, 0.30400, 0.30500, 0.30600, 0.30700, 0.30800, 0.30900, 0.31000, 0.31100, 0.31200, 0.31300, 0.31400, 0.31500, 0.31600, 0.31700, 0.31800, 0.31900, 0.32000, 0.32100, 0.32200, 0.32300, 0.32400, 0.32500, 0.32600, 0.32700, 0.32800, 0.32900, 0.33000, 0.33100, 0.33200, 0.33300, 0.33400, 0.33500, 0.33600, 0.33700, 0.33800, 0.33900, 0.34000, 0.34100, 0.34200, 0.34300, 0.34400, 0.34500, 0.34600, 0.34700, 0.34800, 0.34900, 0.35000, 0.35100, 0.35200, 0.35300, 0.35400, 0.35500, 0.35600, 0.35700, 0.35800, 0.35900, 0.36000, 0.36100, 0.36200, 0.36300, 0.36400, 0.36500, 0.36600, 0.36700, 0.36800, 0.36900, 0.37000, 0.37100, 0.37200, 0.37300, 0.37400, 0.37500, 0.37600, 0.37700, 0.37800, 0.37900, 0.38000, 0.38100, 0.38200, 0.38300, 0.38400, 0.38500, 0.38600, 0.38700, 0.38800, 0.38900, 0.39000, 0.39100, 0.39200, 0.39300, 0.39400, 0.39500, 0.39600, 0.39700, 0.39800, 0.39900, 0.40000, 0.40100, 0.40200, 0.40300, 0.40400, 0.40500, 0.40600, 0.40700, 0.40800, 0.40900, 0.41000, 0.41100, 0.41200, 0.41300, 0.41400, 0.41500, 0.41600, 0.41700, 0.41800, 0.41900, 0.42000, 0.42100, 0.42200, 0.42300, 0.42400, 0.42500, 0.42600, 0.42700, 0.42800, 0.42900, 0.43000, 0.43100, 0.43200, 0.43300, 0.43400, 0.43500, 0.43600, 0.43700, 0.43800, 0.43900, 0.44000, 0.44100, 0.44200, 0.44300, 0.44400, 0.44500, 0.44600, 0.44700, 0.44800, 0.44900, 0.45000, 0.45100, 0.45200, 0.45300, 0.45400, 0.45500, 0.45600, 0.45700, 0.45800, 0.45900, 0.46000, 0.46100, 0.46200, 0.46300, 0.46400, 0.46500, 0.46600, 0.46700, 0.46800, 0.46900, 0.47000, 0.47100, 0.47200, 0.47300, 0.47400, 0.47500, 0.47600, 0.47700, 0.47800, 0.47900, 0.48000, 0.48100, 0.48200, 0.48300, 0.48400, 0.48500, 0.48600, 0.48700, 0.48800, 0.48900, 0.49000, 0.49100, 0.49200, 0.49300, 0.49400, 0.49500, 0.49600, 0.49700, 0.49800, 0.49900, 0.50000, 0.50100, 0.50200, 0.50300, 0.50400, 0.50500, 0.50600, 0.50700, 0.50800, 0.50900, 0.51000, 0.51100, 0.51200, 0.51300, 0.51400, 0.51500, 0.51600, 0.51700, 0.51800, 0.51900, 0.52000, 0.52100, 0.52200, 0.52300, 0.52400, 0.52500, 0.52600, 0.52700, 0.52800, 0.52900, 0.53000, 0.53100, 0.53200, 0.53300, 0.53400, 0.53500, 0.53600, 0.53700, 0.53800, 0.53900, 0.54000, 0.54100, 0.54200, 0.54300, 0.54400, 0.54500, 0.54600, 0.54700, 0.54800, 0.54900, 0.55000, 0.55100, 0.55200, 0.55300, 0.55400, 0.55500, 0.55600, 0.55700, 0.55800, 0.55900, 0.56000, 0.56100, 0.56200, 0.56300, 0.56400, 0.56500, 0.56600, 0.56700, 0.56800, 0.56900, 0.57000, 0.57100, 0.57200, 0.57300, 0.57400, 0.57500, 0.57600, 0.57700, 0.57800, 0.57900, 0.58000, 0.58100, 0.58200, 0.58300, 0.58400, 0.58500, 0.58600, 0.58700, 0.58800, 0.58900, 0.59000};
static real lower_piston_velocity_array[] = {-0.20000, -0.20408, -0.20408, -0.21739, -0.26316, -0.45455, -0.58824, -0.58824, -0.71429, -0.66667, -0.70000, -0.71429, -0.76923, -0.76923, -0.76923, -0.76923, -0.76923, -0.83333, -0.80769, -0.80769, -0.83333, -0.83333, -0.83333, -0.83333, -0.76923, -0.83333, -0.80769, -0.80769, -0.83333, -0.80769, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000, -0.00000};



DEFINE_CG_MOTION(lower_piston, dt, vel, omega, time, dtime)
{
    real closest_time_diff = 1e20; // Large initial value
    int closest_index = -1;
    
    for (int i = 0; i < sizeof(time_array)/sizeof(time_array[0]); i++)
    {
        real time_diff = fabs(time - time_array[i]);
        if (time_diff < closest_time_diff)
        {
            closest_time_diff = time_diff;
            closest_index = i;
        }
    }

    if (closest_index != -1)
    {
        vel[1] = lower_piston_velocity_array[closest_index];
    }
    else
    {
        vel[1] = 0.0; // Default velocity if no close time found
    }
}